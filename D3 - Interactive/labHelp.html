<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>test Cube</title>
    </head>
    <body>
        <canvas width="512" height="512"></canvas>
            <script type="module">
            // Code goes here!
                
                async function setup()
                {
                    //add checks
                    console.log("Checking for support, hardware and adapter.");
                    if (!navigator.gpu) {
                    throw new Error("WebGPU not supported by your browser.");
                    }
                    const adapter = await navigator.gpu.requestAdapter();
                    if (!adapter){
                    throw new Error("WebGPU Supported but not appropriate hardware.");
                    }
                    const device = await adapter.requestDevice();
                    if (!device) {
                    throw new Error("Error supporting WebGPU in your browser");
                    }

                    //get webgpu from canvas and configure canvas
                    console.log("Getting the WebGPU context from our canvas element and configuring it.");
                    const canvas = document.querySelector('canvas');
                    const context = canvas.getContext('webgpu');
                    const canvasFormat = navigator.gpu.getPreferredCanvasFormat();
                    context.configure({
                    device,
                    format: canvasFormat,
                    });
                }

                function startup()
                {
                    const module = device.createShaderModule({
                    label: 'Simple Shader',
                    code: ` `
                    });

                    const pipeline = device.createRenderPipeline({
                        label: 'Hardcoded pipeline',
                        layout: 'auto',
                        vertex: {
                        //entryPoint: 'vs',
                        module,
                        },
                        fragment: {
                        //entryPoint: 'fs',
                        module,
                        targets: [{ format: canvasFormat }],
                        },
                    });

                    const renderPassDescriptor = {
                        label: 'Basic canvas render pass',
                        colorAttachments: [
                        {
                        // view: <- to be filled out when we render
                        clearValue: [1.0, 0.75, 0.60, 1.0],
                        loadOp: 'clear', // clear or store (draw on top)
                        storeOp: 'store', // store or clear (throw away)
                        },
                    ],};
                }

                function render()
                {
                    //describe and set the output to render
                    renderPassDescriptor.colorAttachments[0].view = context.getCurrentTexture().createView();

                    //encoder (everything gets passed here to get processed in a queue)
                    const encoder = device.createCommandEncoder({ label: 'the encoder' });

                    //render pass
                    const pass = encoder.beginRenderPass(renderPassDescriptor);
                    pass.setPipeline(pipeline);
                    pass.draw(6);
                    pass.end();

                    //send to render queue
                    device.queue.submit([commandBuffer]);

                    //encoder finish
                    const commandBuffer = encoder.finish();
                }

                await setup();
                startup();
                //render
                const UPDATE_INTERVAL = 1000.0 /30.0; 
                setInterval(render, UPDATE_INTERVAL);


        </script>
    </body>
</html>